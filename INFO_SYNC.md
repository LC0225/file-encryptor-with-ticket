# 📡 信息互通说明

## 🎯 核心问题：本地部署后信息是否互通？

**答案**：取决于是否配置了云端同步

---

## 📊 信息存储架构

```
┌─────────────────────────────────────────────────────────┐
│                      用户界面层                           │
│              (React 组件 + Hooks)                        │
└─────────────────────┬───────────────────────────────────┘
                      │
         ┌────────────┴────────────┐
         │                         │
         ↓                         ↓
┌──────────────────┐      ┌──────────────────┐
│   Local Storage  │      │   Supabase       │
│   (浏览器本地)   │◄────►│   (云端同步)     │
│                  │      │                  │
│ - crypto_users   │      │ - Storage Bucket │
│ - encryption_    │      │   file-encrypt/  │
│   history_{id}   │      │   app-data.json  │
│ - crypto_sync_   │      │                  │
│   status         │      │                  │
└──────────────────┘      └──────────────────┘
```

---

## 🔍 信息互通的三种情况

### 情况 1：仅使用本地存储（未配置 Supabase）

#### 存储位置
- 浏览器的 localStorage
- 每个浏览器独立存储
- 每个设备独立存储

#### 信息互通性
```
❌ 不同设备之间：信息不通
❌ 不同浏览器之间：信息不通
✅ 同一设备同一浏览器：信息互通
```

#### 实例说明

| 场景 | 结果 |
|-----|------|
| **电脑A Chrome** 加密的文件 | ✅ 电脑A Chrome 可以解密 |
| **电脑A Firefox** | ❌ 无法解密（不同浏览器） |
| **电脑B Chrome** | ❌ 无法解密（不同设备） |
| **手机 Chrome** | ❌ 无法解密（不同设备） |

#### 数据流程
```
电脑A Chrome:
  加密文件 → 存储到 localStorage
  ↓
电脑A Chrome:
  从 localStorage 读取 → 解密文件
```

#### 优点
- ✅ 完全离线可用
- ✅ 不依赖外部服务
- ✅ 数据只在本地，更安全

#### 缺点
- ❌ 无法跨设备访问
- ❌ 无法跨浏览器访问
- ❌ 数据丢失无法恢复（除非手动备份）

---

### 情况 2：配置 Supabase 云端同步（推荐）⭐⭐⭐

#### 存储位置
- 主要存储：Supabase Storage（云端）
- 本地缓存：localStorage（自动同步）

#### 信息互通性
```
✅ 不同设备之间：信息互通
✅ 不同浏览器之间：信息互通
✅ 同一设备同一浏览器：信息互通
```

#### 实例说明

| 场景 | 结果 |
|-----|------|
| **电脑A Chrome** 加密的文件 | ✅ 所有设备所有浏览器都可以解密 |
| **电脑A Firefox** | ✅ 可以解密（数据已同步到云端） |
| **电脑B Chrome** | ✅ 可以解密（从云端获取） |
| **手机 Chrome** | ✅ 可以解密（从云端获取） |
| **平板 Safari** | ✅ 可以解密（从云端获取） |

#### 数据流程
```
电脑A Chrome:
  加密文件 → 上传到 Supabase Cloud
    ↓
Supabase Cloud (云端):
  存储加密历史、用户数据
    ↓
电脑B Chrome:
  从 Supabase Cloud 下载 → 解密文件
```

#### 优点
- ✅ 跨设备访问
- ✅ 跨浏览器访问
- ✅ 数据自动备份
- ✅ 支持多人协作（同一账号）

#### 缺点
- ⚠️ 需要网络连接
- ⚠️ 需要配置 Supabase
- ⚠️ 数据存储在云端

---

### 情况 3：混合模式（灵活切换）

#### 存储策略
- 优先使用云端数据
- 云端不可用时降级到本地存储
- 网络恢复后自动同步

#### 信息互通性
```
✅ 有网络：信息互通（云端同步）
⚠️ 无网络：仅本地可用
✅ 网络恢复：自动同步
```

#### 实例说明

| 场景 | 结果 |
|-----|------|
| **有网络** 加密文件 | ✅ 自动上传到云端 |
| **断网后** | ✅ 可以继续使用（本地数据） |
| **恢复网络后** | ✅ 自动同步到云端 |
| **多设备同时使用** | ✅ 实时同步 |

---

## 🔧 如何配置信息互通

### 配置 Supabase 云端同步

#### 步骤 1：创建 Supabase 项目

1. 访问 https://supabase.com
2. 注册/登录账号
3. 点击 "New Project"
4. 创建项目（2-3 分钟）

#### 步骤 2：获取凭证

1. 进入项目 Dashboard
2. 点击 Settings → API
3. 复制以下信息：
   - Project URL
   - anon public key

#### 步骤 3：配置环境变量

编辑 `.env.local` 文件：

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
```

#### 步骤 4：创建 Storage Bucket

1. 在 Supabase Dashboard 点击 **Storage**
2. 点击 **New bucket**
3. 创建名为 `file-encrypt` 的 bucket

#### 步骤 5：重启应用

```bash
# 停止服务（Ctrl+C）
# 重新启动
yarn dev
```

---

## 📊 信息互通对比表

| 功能 | 本地存储 | 云端同步 | 混合模式 |
|-----|---------|---------|---------|
| **单设备使用** | ✅ 完美 | ✅ 完美 | ✅ 完美 |
| **多设备使用** | ❌ 不支持 | ✅ 完美 | ✅ 完美 |
| **跨浏览器** | ❌ 不支持 | ✅ 完美 | ✅ 完美 |
| **离线使用** | ✅ 完美 | ❌ 需要网络 | ✅ 支持离线 |
| **数据备份** | ❌ 需手动 | ✅ 自动 | ✅ 自动 |
| **安全性** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **隐私性** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **便利性** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## 💡 使用建议

### 个人使用场景

**如果只在单台电脑上使用**：
- 推荐使用 **本地存储**
- 不需要配置 Supabase
- 更简单，更安全

**如果多设备使用**：
- 推荐配置 **云端同步**
- 使用 Supabase
- 一次配置，处处可用

### 团队使用场景

**团队协作**：
- 必须配置 **云端同步**
- 同一团队成员可以访问共享数据
- 支持数据协作和备份

---

## 🔒 安全性说明

### 本地存储
- ✅ 数据只存储在本地浏览器
- ✅ 即使 Supabase 被攻击，数据安全
- ❌ 设备损坏或清理浏览器，数据丢失

### 云端同步
- ✅ Supabase 使用 AES-256 加密
- ✅ 只有有权限的人可以访问
- ✅ 数据有备份，不会丢失
- ⚠️ 数据存储在云端

---

## 🎯 推荐配置

### 99% 的用户推荐配置

```
配置 Supabase 云端同步
    ↓
享受跨设备、跨浏览器的便利
    ↓
同时支持离线使用
```

**理由**：
- ✅ 一次配置，永久受益
- ✅ 数据自动备份
- ✅ 任何设备都能访问
- ✅ 离线也能使用（本地缓存）

---

## 📝 配置检查清单

确认信息互通是否正常：

- [ ] Supabase 环境变量已配置
- [ ] Storage Bucket 已创建
- [ ] 在一台设备上注册账号
- [ ] 加密一个文件
- [ ] 在另一台设备上登录同一账号
- [ ] 检查是否能看到加密历史
- [ ] 尝试解密文件

---

## ❓ 常见问题

### Q1: 本地存储的数据可以导出吗？

**答**：可以，但需要手动操作：
1. 打开浏览器开发者工具（F12）
2. 进入 Application/应用 → Local Storage
3. 复制需要的数据
4. 在其他设备上粘贴

**建议**：使用云端同步，自动完成导出和导入。

### Q2: 云端同步需要付费吗？

**答**：Supabase 免费版就够用：
- 500MB 存储
- 1GB 带宽/月
- 无限 API 请求
- 对于个人用户完全足够

### Q3: 可以在本地和云端之间切换吗？

**答**：可以！应用支持混合模式：
- 有网络时自动同步到云端
- 无网络时使用本地存储
- 网络恢复后自动同步

### Q4: 数据同步是实时的吗？

**答**：
- 加密/解密后自动上传（实时）
- 手动点击"从云端同步"（手动）
- 其他设备需要手动同步或刷新

### Q5: 多人可以同时使用同一账号吗？

**答**：
- 可以，但不建议
- 每个人应该有自己的账号
- 使用管理员功能管理用户

---

## 🎉 总结

### 信息互通的关键

```
✅ 配置 Supabase → 信息互通
❌ 不配置 Supabase → 信息不通
```

### 最简单的配置

```bash
1. 复制 .env.example 到 .env.local
2. 填入 Supabase URL 和 Key
3. 重启应用
```

**就这么简单！** 🚀

---

## 📞 需要帮助？

如果还有疑问：
- 查看 `LOCAL_DEPLOYMENT.md` 了解本地部署
- 查看 `DEPLOYMENT.md` 了解 Supabase 配置
- 查看 `TROUBLESHOOTING.md` 解决常见问题
